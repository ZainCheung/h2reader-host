(this.webpackJsonpmbapp=this.webpackJsonpmbapp||[]).push([[0],{200:function(e,t,a){e.exports=a(388)},378:function(e,t,a){},388:function(e,t,a){"use strict";a.r(t);var s,n,r,l=a(0),o=a.n(l),c=a(11),i=a.n(c),m=a(15),p=a(9),d=a(4),h=a(8);let u=(s=Object(h.c)(),n=Object(d.b)("store"),Object(p.f)(r=s(r=n(r=Object(d.c)(r=class extends l.Component{setLang(e){this.props.i18n.changeLanguage(e)}render(){return o.a.createElement("div",null,o.a.createElement("span",{className:"pointer",onClick:()=>this.setLang("zh-cn")},"\u4e2d\u6587")," \xb7 ",o.a.createElement("span",{className:"pointer",onClick:()=>this.setLang("en")},"English"))}})||r)||r)||r)||r);var E,b,g,k=a(44),v=a.n(k);E=Object(h.c)(),b=Object(d.b)("store"),Object(p.f)(g=E(g=b(g=Object(d.c)(g=class extends l.Component{render(){const{t:e}=this.props,t=o.a.createElement("div",{className:"box"},o.a.createElement("div",{className:"title"},e("Welcome")),o.a.createElement("div",{className:"lang"}," ",o.a.createElement(u,null)));return o.a.createElement(v.a,{title:this.props.store.appname},t)}})||g)||g)||g);var f,N,O,j=a(59);a(221),a(222);let _=(f=Object(h.c)(),N=Object(d.b)("store"),Object(p.f)(O=f(O=N(O=Object(d.c)(O=class extends l.Component{render(){const e=this.props,t=e.data.base64||"/image/h2editor.logo.png",a=e.className?"avatar-square "+e.className:"avatar-square ";return o.a.createElement("div",{className:a,onClick:t=>{e.onClick&&e.onClick(t)}},o.a.createElement("img",{src:t,alt:e.data.name}))}})||O)||O)||O)||O);var w,x,C,y=a(131),S=a.n(y),I=a(79),R=a.n(I);function D(e){return o.a.createElement("a",{href:e.href,target:"_blank"},e.children)}function T(e){return o.a.createElement(S.a,{image:{src:e.src,className:"imginbox"}})}let M=(w=Object(h.c)(),x=Object(d.b)("store"),Object(p.f)(C=w(C=x(C=Object(d.c)(C=class extends l.Component{render(){this.props.store;const e=this.props;if(!e.data)return null;const t=e.data,a=e.roles.filter(e=>e.id==t.role_id)[0],s=t.role_ismain?" role main ":" role notmain";return"role"==t.type?o.a.createElement("div",{className:"talk-list-item-ro"+s,"data-id":t.id},o.a.createElement("div",{className:"avatarside"},o.a.createElement(_,{data:a,className:"s48"})),o.a.createElement("div",{className:"contentside"},o.a.createElement("div",{className:"name"},a.name),o.a.createElement("div",{className:"text"},o.a.createElement(R.a,{source:t.text,renderers:{link:D,image:T}})))):o.a.createElement("div",{className:"talk-list-item-ro aside"},o.a.createElement("div",{className:"aside-text"},o.a.createElement(R.a,{source:t.text,renderers:{link:D,image:T}})))}})||C)||C)||C)||C);var B,L,U,J=a(391);let q=(B=Object(h.c)(),L=Object(d.b)("store"),Object(p.f)(U=B(U=L(U=Object(d.c)(U=class extends l.Component{constructor(e){super(e),this.showToId=e=>{let t=-1;this.alltalks.forEach((a,s)=>{a.id==e&&(t=s)}),console.log("to_index",t),t>=0&&(this.setState({show_talks:this.alltalks.slice(0,t+1),talks:this.alltalks.slice(t+1)}),setTimeout(()=>{this.toBottom()},100))},this.showOne=()=>{const e=this.state;if(e.talks.length<1)return this.setState({end:!0}),!1;let t=e.talks,a=t.shift(),s=e.show_talks;return s.push(a),this.setState({talks:t,show_talks:s}),setTimeout(()=>{this.toBottom()},100),a},this.toBottom=()=>{this.end_ref&&this.end_ref.current&&this.end_ref.current.scrollIntoView(!0)},this.state={talks:[],show_talks:[],end:!1},this.end_ref=o.a.createRef()}componentDidMount(){this.loadData()}loadData(){this.alltalks=this.props.talks,this.setState({talks:this.props.talks,end:this.props.talks.length<1})}componentDidUpdate(e){this.props.current_talk_id!==e.current_talk_id&&(this.loadData(),this.showToId(this.props.current_talk_id),this.toBottom())}goBack(){if(!window.confirm("\u5f53\u524d\u7ae0\u8282\u5df2\u7ecf\u5b8c\u6210\uff0c\u662f\u5426\u8fd4\u56de\u9996\u9875\uff1f"))return!1;this.props.history.push("/")}render(){const e=this.state,t=this.props;return e.talks?o.a.createElement("div",{className:"talklist-ro"},o.a.createElement("div",{className:"thelist"},e.show_talks.length>0?o.a.createElement(o.a.Fragment,null,e.show_talks.map(e=>o.a.createElement(M,{roles:t.roles,key:e.id,data:e}))):o.a.createElement("div",{className:"guide"},o.a.createElement("div",{className:"logo"}," ",o.a.createElement("img",{src:"/image/h2.logo.png"})," "),o.a.createElement("div",{className:"back"},o.a.createElement(m.b,{to:"/"},o.a.createElement(J.d,{iconSize:40,icon:"circle-arrow-left"}))),this.props.meta&&o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"name"},this.props.meta.name),o.a.createElement("div",{className:"author"},o.a.createElement(J.d,{icon:"user"})," ",this.props.meta.author),o.a.createElement("div",{className:"link"},o.a.createElement(J.d,{icon:"link"})," ",this.props.meta.link),o.a.createElement("div",{className:"detail"},this.props.meta.detail)),o.a.createElement("div",{className:"continue"},"\u70b9\u51fb\u4e0b\u65b9\u7684 \u2726 \u5f00\u59cb")),o.a.createElement("div",{ref:this.end_ref,style:{marginTop:"100px"}})),o.a.createElement("div",{className:"touchpad",onClick:()=>this.showOne()},e.end?o.a.createElement("span",{className:"blink noselect",onClick:()=>this.goBack()}," done "):o.a.createElement("span",{className:"blink noselect"}," \u2726 "))):null}})||U)||U)||U)||U);var z,F,P;let H=(z=Object(h.c)(),F=Object(d.b)("store"),Object(p.f)(P=z(P=F(P=Object(d.c)(P=class extends l.Component{constructor(){super(...arguments),this.state={meta:{},talks:[],roles:[],show_talks:[]}}componentDidMount(){let e=1,t="/books/".concat(e,".h2book");const a=this.props.match.params.id;isNaN(a)?t=decodeURIComponent(a):(e=parseInt(a)>0?parseInt(a):1,t="/books/".concat(e,".h2book"));try{!function(e,t){var a=new XMLHttpRequest;a.overrideMimeType("application/json"),a.open("GET",e,!0),a.onreadystatechange=function(){4===a.readyState&&"200"==a.status&&t(a.responseText)},a.send(null)}(t,e=>{const t=JSON.parse(e);t&&this.setState(Object(j.a)({},t))})}catch(s){alert("\u6587\u4ef6\u8f7d\u5165\u5931\u8d25\uff0c\u8bf7\u8fd4\u56de\u786e\u8ba4\u5730\u5740\u662f\u5426\u6b63\u786e\u3002"),console.log(err),this.props.history.replace("/")}}render(){const e=this.state,t=o.a.createElement("div",{className:"read-page"},e.talks&&e.talks.length>0&&o.a.createElement(q,{talks:e.talks,roles:e.roles,meta:e.meta})),a=e.meta.name?e.meta.name+"@"+this.props.store.appname:this.props.store.appname;return o.a.createElement(v.a,{title:a},t)}})||P)||P)||P)||P);var W,G,V;let X=(W=Object(h.c)(),G=Object(d.b)("store"),Object(p.f)(V=W(V=G(V=Object(d.c)(V=class extends l.Component{render(){const e=this.props.data;return e?o.a.createElement("li",{onClick:()=>this.props.history.push("/read/"+encodeURIComponent(e.bookurl))},o.a.createElement("span",null,e.name),o.a.createElement(J.b,{icon:"chevron-right",minimal:!0})):null}})||V)||V)||V)||V);var A,K,Y=a(140),$=a(49),Q=a.n($),Z=a(134),ee=a.n(Z);let te=(A=Object(d.b)("store"),Object(p.f)(K=A(K=Object(d.c)(K=class extends l.Component{constructor(){super(...arguments),this.state={value:this.props.value,img_url:""}}componentDidMount(){this.ck=setInterval(()=>this.check(),1e3)}check(){const e=document.getElementById("theqr__inbox");e&&(this.setState({img_url:e.toDataURL("image/png")}),clearInterval(this.ck))}render(){return o.a.createElement("div",{className:this.props.className},this.state.img_url.length>0?o.a.createElement("img",{src:this.state.img_url}):o.a.createElement(ee.a,{size:300,value:this.state.value,id:"theqr__inbox",includeMargin:!0}))}})||K)||K)||K);var ae,se,ne,re=a(135);let le=(ae=Object(h.c)(),se=Object(d.b)("store"),Object(p.f)(ne=ae(ne=se(ne=Object(d.c)(ne=class extends l.Component{constructor(e){super(e),this.drop_ref=o.a.createRef(),this.state={url:!1}}async onDropped(e){if(!this.props.upload_url)return alert("\u9519\u8bef\u7684\u4e0a\u4f20\u5730\u5740"),!1;const t=new FormData;t.append("book",e[0]);const{data:a}=await Q.a.post(this.props.upload_url,t);a.code>0?alert(a.message):a.data&&a.data.url&&this.setState({url:a.data.url})}onClose(){if(!window.confirm("\u5173\u95ed\u540e\u5c06\u65e0\u6cd5\u627e\u5230\u8fd9\u4e2a\u5730\u5740\uff0c\u8bf7\u786e\u5b9a\u4fdd\u5b58\u540e\u518d\u5173\u95ed\u3002\u662f\u5426\u7ee7\u7eed\uff1f"))return!1;this.setState({url:!1})}render(){const e=this.props.site_url+"/read/"+encodeURIComponent(encodeURIComponent(this.state.url));return o.a.createElement(o.a.Fragment,null,o.a.createElement(Y.a,{accept:".h2book",maxSize:10485760,multiple:!1,ref:this.drop_ref,onDrop:e=>this.onDropped(e)},e=>{let{getRootProps:t,getInputProps:a}=e;return o.a.createElement("div",t(),o.a.createElement("input",a()),o.a.createElement(J.b,{icon:"upload",large:!0}))}),o.a.createElement(J.f,{isOpen:this.state.url},o.a.createElement("div",{className:"overbox"},o.a.createElement("div",{className:"centerbox"},o.a.createElement(te,{value:e}),o.a.createElement("div",null,o.a.createElement("div",{className:"explain"},"\u5fae\u4fe1\u626b\u7801\u5373\u53ef\u9605\u8bfb\uff0c\u53ef\u4fdd\u5b58\u56fe\u7247\u5206\u4eab\u5230\u670b\u53cb\u5708"),o.a.createElement("div",{className:"therow"},o.a.createElement(J.b,{text:"\u5173\u95ed",icon:"cross",onClick:()=>this.onClose(),large:!0}),o.a.createElement(J.a,{href:e,icon:"manual",text:"\u5f00\u59cb\u9605\u8bfb",large:!0,intent:"PRIMARY"})),o.a.createElement("div",{className:"std-hr"}),o.a.createElement(J.c,{fill:!0,vertical:!1},o.a.createElement(J.e,{value:e,readOnly:!0,large:!0}),o.a.createElement(re.CopyToClipboard,{text:e,onCopy:()=>alert("\u5df2\u590d\u5236\u5230\u526a\u8d34\u677f")},o.a.createElement(J.b,{text:"\u590d\u5236\u9605\u8bfb\u5730\u5740",large:!0}))))))))}})||ne)||ne)||ne)||ne);var oe,ce,ie;let me=(oe=Object(h.c)(),ce=Object(d.b)("store"),Object(p.f)(ie=oe(ie=ce(ie=Object(d.c)(ie=class extends l.Component{constructor(){super(...arguments),this.state={books:[],bookurl:""}}doJump(){this.props.history.push("/read/"+encodeURIComponent(encodeURIComponent(this.state.bookurl)))}componentDidMount(){!function(e,t){var a=new XMLHttpRequest;a.overrideMimeType("application/json"),a.open("GET",e,!0),a.onreadystatechange=function(){4===a.readyState&&"200"==a.status&&t(a.responseText)},a.send(null)}("books/index.json",e=>{e&&this.setState(Object(j.a)({},JSON.parse(e)))})}render(){const e=this.state.books;let t=1;const a=o.a.createElement("div",{className:"list-page"},o.a.createElement("div",{className:"jumpbox"},o.a.createElement("div",{className:"row"},o.a.createElement("div",{className:"left"},o.a.createElement(J.c,{fill:!0,vertical:!1},o.a.createElement(J.e,{placeholder:"\u8f93\u5165.h2book\u6587\u4ef6\u7684url...",value:this.state.bookurl,onChange:e=>{this.setState({bookurl:e.target.value})},large:!0}),o.a.createElement(J.b,{icon:"arrow-right",onClick:()=>{this.doJump()},large:!0}))),this.state.upload_url&&o.a.createElement("div",{className:"right"},o.a.createElement(le,{upload_url:this.state.upload_url,site_url:this.state.site_url})))),o.a.createElement("div",{className:"logoline"},o.a.createElement("img",{src:"/image/h2.logo.png",alt:"logo"})),o.a.createElement("ul",{className:"booklist"},e.length>0&&e.map(e=>o.a.createElement(X,{key:t++,data:e}))));return o.a.createElement(v.a,{title:this.props.store.appname},a)}})||ie)||ie)||ie)||ie);class pe extends l.Component{render(){return o.a.createElement(m.a,null,o.a.createElement(p.c,null,o.a.createElement(p.a,{path:"/read/:id",component:H}),o.a.createElement(p.a,{path:"/",component:me})))}}var de=pe;Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var he,ue,Ee=a(136),be=a(137),ge=(a(377),a(3));var ke=new(he=class{constructor(){Object(Ee.a)(this,"appname",ue,this)}},ue=Object(be.a)(he.prototype,"appname",[ge.l],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"\u65b9\u7cd6\u5c0f\u5267\u573a"}}),he),ve=(a(378),a(82)),fe=a(138),Ne=a(139),Oe=a.n(Ne);ve.a.use(fe.a).use(Oe.a).use(h.b).init({fallbackLng:"zh-cn",ns:["translations"],defaultNS:"translations",debug:!1,saveMissing:!1,missingKeyHandler:function(e,t,a){var s=new URLSearchParams;s.append("lng",JSON.stringify(e)),s.append("ns",t),s.append("key",a);const{data:n}=Q.a.post("http://localhost:8088/misswords",s)},interpolation:{escapeValue:!1},react:{wait:!0}});var je=ve.a;i.a.render(o.a.createElement(d.a,{store:ke},o.a.createElement(h.a,{i18n:je},o.a.createElement(de,null))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(e=>{e.unregister()})}},[[200,1,2]]]);
//# sourceMappingURL=main.24c8068a.chunk.js.map