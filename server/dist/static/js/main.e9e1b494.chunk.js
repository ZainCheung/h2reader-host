(this.webpackJsonpmbapp=this.webpackJsonpmbapp||[]).push([[0],{196:function(e,t,a){e.exports=a(384)},374:function(e,t,a){},384:function(e,t,a){"use strict";a.r(t);var s,n,l,r=a(0),o=a.n(r),c=a(13),i=a.n(c),m=a(16),p=a(11),d=a(5),h=a(10);let u=(s=Object(h.c)(),n=Object(d.b)("store"),Object(p.f)(l=s(l=n(l=Object(d.c)(l=class extends r.Component{setLang(e){this.props.i18n.changeLanguage(e)}render(){return o.a.createElement("div",null,o.a.createElement("span",{className:"pointer",onClick:()=>this.setLang("zh-cn")},"\u4e2d\u6587")," \xb7 ",o.a.createElement("span",{className:"pointer",onClick:()=>this.setLang("en")},"English"))}})||l)||l)||l)||l);var E,g,b,k=a(44),v=a.n(k);E=Object(h.c)(),g=Object(d.b)("store"),Object(p.f)(b=E(b=g(b=Object(d.c)(b=class extends r.Component{render(){const{t:e}=this.props,t=o.a.createElement("div",{className:"box"},o.a.createElement("div",{className:"title"},e("Welcome")),o.a.createElement("div",{className:"lang"}," ",o.a.createElement(u,null)));return o.a.createElement(v.a,{title:this.props.store.appname},t)}})||b)||b)||b);var f,O,w,N=a(59);a(217),a(218);let j=(f=Object(h.c)(),O=Object(d.b)("store"),Object(p.f)(w=f(w=O(w=Object(d.c)(w=class extends r.Component{render(){const e=this.props,t=e.data.base64||"/image/h2.any.png",a=e.className?"avatar-square "+e.className:"avatar-square ";return o.a.createElement("div",{className:a,onClick:t=>{e.onClick&&e.onClick(t)}},o.a.createElement("img",{src:t,alt:e.data.name}))}})||w)||w)||w)||w);var y,_,x,C=a(131),S=a.n(C),D=a(79),I=a.n(D);function R(e){return o.a.createElement("a",{href:e.href,target:"_blank"},e.children)}function T(e){return o.a.createElement(S.a,{image:{src:e.src,className:"imginbox"}})}let B=(y=Object(h.c)(),_=Object(d.b)("store"),Object(p.f)(x=y(x=_(x=Object(d.c)(x=class extends r.Component{render(){this.props.store;const e=this.props;if(!e.data)return null;const t=e.data,a=e.roles.filter(e=>e.id==t.role_id)[0],s=t.role_ismain?" role main ":" role notmain";return"role"==t.type?o.a.createElement("div",{className:"talk-list-item-ro"+s,"data-id":t.id},o.a.createElement("div",{className:"avatarside"},o.a.createElement(j,{data:a,className:"s48"})),o.a.createElement("div",{className:"contentside"},o.a.createElement("div",{className:"name"},a.name),o.a.createElement("div",{className:"text"},o.a.createElement(I.a,{source:t.text,renderers:{link:R,image:T}})))):o.a.createElement("div",{className:"talk-list-item-ro aside"},o.a.createElement("div",{className:"aside-text"},o.a.createElement(I.a,{source:t.text,renderers:{link:R,image:T}})))}})||x)||x)||x)||x);var K,A,M,U=a(387),H=a(37);let L=(K=Object(h.c)(),A=Object(d.b)("store"),Object(p.f)(M=K(M=A(M=Object(d.c)(M=class extends r.Component{constructor(e){super(e),this.showToId=e=>{let t=-1;this.alltalks.forEach((a,s)=>{a.id==e&&(t=s)}),console.log("to_index",t),t>=0&&(this.setState({show_talks:this.alltalks.slice(0,t+1),talks:this.alltalks.slice(t+1)}),setTimeout(()=>{this.toBottom()},100))},this.showOne=()=>{const e=this.state;if(e.talks.length<1)return this.setState({end:!0}),!1;let t=e.talks,a=t.shift(),s=e.show_talks;return s.push(a),this.setState({talks:t,show_talks:s}),setTimeout(()=>{this.toBottom()},100),a},this.toBottom=()=>{this.end_ref&&this.end_ref.current&&this.end_ref.current.scrollIntoView(!0)},this.state={talks:[],show_talks:[],end:!1,isAlertOpen:!1,alertData:{message:"",nextBook:null,confirmHandler:null,cancelHandler:null}},this.end_ref=o.a.createRef()}componentDidMount(){this.loadData()}loadData(){this.alltalks=this.props.talks,this.setState({talks:this.props.talks,end:this.props.talks.length<1})}componentDidUpdate(e){this.props.current_talk_id!==e.current_talk_id&&(this.loadData(),this.showToId(this.props.current_talk_id),this.toBottom())}showAlert(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,a=arguments.length>2?arguments[2]:void 0,s=arguments.length>3?arguments[3]:void 0;this.setState({isAlertOpen:!0,alertData:{message:e,nextBook:t,confirmHandler:a,cancelHandler:s}})}goBack(){let e=this.props.location.pathname.split("/").pop();e=decodeURIComponent(e),e=e.replace(/\.h2book$/,""),fetch("/books/index.json").then(e=>e.json()).then(t=>{const a=t.books,s=a.findIndex(t=>t.bookurl===e);if(s>-1&&s<a.length-1){const e=a[s+1];this.showAlert("\u662f\u5426\u7ee7\u7eed\u9605\u8bfb\u4e0b\u4e00\u7ae0\u300a".concat(e.name,"\u300b\uff1f"),e,()=>{this.setState({isAlertOpen:!1}),window.location.href="/read/".concat(e.bookurl)},()=>{this.setState({isAlertOpen:!1}),window.location.href="/"})}else window.location.href="/"}).catch(e=>{console.error("Error:",e),this.showAlert("\u5f53\u524d\u7ae0\u8282\u5df2\u7ecf\u5b8c\u6210\uff0c\u662f\u5426\u8fd4\u56de\u9996\u9875\uff1f",null,()=>{this.setState({isAlertOpen:!1}),window.location.href="/"},()=>{this.setState({isAlertOpen:!1})})})}render(){const e=this.state,t=this.props;return e.talks?o.a.createElement("div",{className:"talklist-ro"},o.a.createElement(U.a,{isOpen:e.isAlertOpen,confirmButtonText:e.alertData.nextBook?"\u7ee7\u7eed\u9605\u8bfb":"\u8fd4\u56de\u9996\u9875",cancelButtonText:"\u53d6\u6d88",intent:H.a.PRIMARY,icon:"help",onConfirm:e.alertData.confirmHandler,onCancel:e.alertData.cancelHandler,canEscapeKeyCancel:!0,canOutsideClickCancel:!0},e.alertData.message),o.a.createElement("div",{className:"thelist"},e.show_talks.length>0?o.a.createElement(o.a.Fragment,null,e.show_talks.map(e=>o.a.createElement(B,{roles:t.roles,key:e.id,data:e}))):o.a.createElement("div",{className:"guide"},o.a.createElement("div",{className:"logo"}," ",o.a.createElement("img",{src:"/image/h2.logo.png"})," "),o.a.createElement("div",{className:"back"},o.a.createElement(m.b,{to:"/"},o.a.createElement(U.g,{iconSize:40,icon:"circle-arrow-left"}))),this.props.meta&&o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"name"},this.props.meta.name),o.a.createElement("div",{className:"author"},o.a.createElement(U.g,{icon:"user"})," ",this.props.meta.author),o.a.createElement("div",{className:"link"},o.a.createElement(U.g,{icon:"link"})," ",this.props.meta.link),o.a.createElement("div",{className:"detail"},this.props.meta.detail)),o.a.createElement("div",{className:"continue"},"\u70b9\u51fb\u4e0b\u65b9\u7684 \u2726 \u5f00\u59cb")),o.a.createElement("div",{ref:this.end_ref,style:{marginTop:"100px"}})),o.a.createElement("div",{className:"touchpad",onClick:()=>this.showOne()},e.end?o.a.createElement("span",{className:"blink noselect",onClick:()=>this.goBack()}," done "):o.a.createElement("span",{className:"blink noselect"}," \u2726 "))):null}})||M)||M)||M)||M);var F,J,q;let z=(F=Object(h.c)(),J=Object(d.b)("store"),Object(p.f)(q=F(q=J(q=Object(d.c)(q=class extends r.Component{constructor(){super(...arguments),this.state={meta:{},talks:[],roles:[],show_talks:[]}}componentDidMount(){let e=1,t="/books/".concat(e,".h2book");const a=this.props.match.params.id;isNaN(a)?t=decodeURIComponent(a):(e=parseInt(a)>0?parseInt(a):1,t="/books/".concat(e,".h2book"));try{!function(e,t){var a=new XMLHttpRequest;a.overrideMimeType("application/json"),a.open("GET",e,!0),a.onreadystatechange=function(){4===a.readyState&&"200"==a.status&&t(a.responseText)},a.send(null)}(t,e=>{const t=JSON.parse(e);if(t){const e=(a=t.talks,[...a].sort((e,t)=>e.chapter_id!==t.chapter_id?e.chapter_id-t.chapter_id:e.order-t.order));t.talks=e,this.setState(Object(N.a)({},t))}var a})}catch(s){alert("\u6587\u4ef6\u8f7d\u5165\u5931\u8d25\uff0c\u8bf7\u8fd4\u56de\u786e\u8ba4\u5730\u5740\u662f\u5426\u6b63\u786e\u3002"),console.log(s),this.props.history.replace("/")}}render(){const e=this.state,t=o.a.createElement("div",{className:"read-page"},e.talks&&e.talks.length>0&&o.a.createElement(L,{talks:e.talks,roles:e.roles,meta:e.meta})),a=e.meta.name?e.meta.name+"@"+this.props.store.appname:this.props.store.appname;return o.a.createElement(v.a,{title:a},t)}})||q)||q)||q)||q);var P,W,G;let V=(P=Object(h.c)(),W=Object(d.b)("store"),Object(p.f)(G=P(G=W(G=Object(d.c)(G=class extends r.Component{render(){const e=this.props.data;return e?o.a.createElement("li",{onClick:()=>this.props.history.push("/read/"+encodeURIComponent(e.bookurl))},o.a.createElement("span",null,e.name),o.a.createElement(U.c,{icon:"chevron-right",minimal:!0})):null}})||G)||G)||G)||G);var X,Y,$=a(140),Q=a(49),Z=a.n(Q),ee=a(134),te=a.n(ee);let ae=(X=Object(d.b)("store"),Object(p.f)(Y=X(Y=Object(d.c)(Y=class extends r.Component{constructor(){super(...arguments),this.state={value:this.props.value,img_url:""}}componentDidMount(){this.ck=setInterval(()=>this.check(),1e3)}check(){const e=document.getElementById("theqr__inbox");e&&(this.setState({img_url:e.toDataURL("image/png")}),clearInterval(this.ck))}render(){return o.a.createElement("div",{className:this.props.className},this.state.img_url.length>0?o.a.createElement("img",{src:this.state.img_url}):o.a.createElement(te.a,{size:300,value:this.state.value,id:"theqr__inbox",includeMargin:!0}))}})||Y)||Y)||Y);var se,ne,le,re=a(135);let oe=(se=Object(h.c)(),ne=Object(d.b)("store"),Object(p.f)(le=se(le=ne(le=Object(d.c)(le=class extends r.Component{constructor(e){super(e),this.drop_ref=o.a.createRef(),this.state={url:!1,showKeyDialog:!1,uploadKey:"",selectedFile:null}}async onDropped(e){this.setState({selectedFile:e[0],showKeyDialog:!0})}async handleUpload(){try{const e=new FormData;e.append("book",this.state.selectedFile),e.append("upload_key",this.state.uploadKey);let t=this.props.upload_url;if(t.startsWith("/")){const e=window.location.protocol,a=window.location.host;t="".concat(e,"//").concat(a).concat(t)}const a=await Z.a.post(t,e,{headers:{"Content-Type":"multipart/form-data"}});0===a.data.code?this.setState({url:a.data.data.url,showKeyDialog:!1,uploadKey:"",selectedFile:null}):alert("\u4e0a\u4f20\u5931\u8d25: "+a.data.message)}catch(e){console.error("Upload error:",e),e.response&&e.response.data&&e.response.data.message?alert("\u4e0a\u4f20\u5931\u8d25: "+e.response.data.message):alert("\u4e0a\u4f20\u5931\u8d25,\u8bf7\u68c0\u67e5\u670d\u52a1\u5668\u8fde\u63a5")}}onClose(){if(!window.confirm("\u5173\u95ed\u540e\u5c06\u65e0\u6cd5\u627e\u5230\u8fd9\u4e2a\u5730\u5740\uff0c\u8bf7\u786e\u5b9a\u4fdd\u5b58\u540e\u518d\u5173\u95ed\u3002\u662f\u5426\u7ee7\u7eed\uff1f"))return!1;this.setState({url:!1})}render(){const e=window.location.origin,t=this.props.site_url||e,a=this.state.url?"".concat(t,"/read/").concat(encodeURIComponent(this.state.url)):"";return o.a.createElement(o.a.Fragment,null,o.a.createElement($.a,{accept:".h2book",maxSize:10485760,multiple:!1,ref:this.drop_ref,onDrop:e=>this.onDropped(e)},e=>{let{getRootProps:t,getInputProps:a}=e;return o.a.createElement("div",t(),o.a.createElement("input",a()),o.a.createElement(U.c,{icon:"upload",large:!0}))}),o.a.createElement(U.e,{isOpen:this.state.showKeyDialog,onClose:()=>this.setState({showKeyDialog:!1}),title:"\u8bf7\u8f93\u5165\u4e0a\u4f20\u5bc6\u94a5"},o.a.createElement("div",{className:"bp3-dialog-body"},o.a.createElement(U.f,{label:"\u4e0a\u4f20\u5bc6\u94a5"},o.a.createElement(U.h,{value:this.state.uploadKey,onChange:e=>this.setState({uploadKey:e.target.value}),placeholder:"\u8bf7\u8f93\u5165\u4e0a\u4f20\u5bc6\u94a5"}))),o.a.createElement("div",{className:"bp3-dialog-footer"},o.a.createElement("div",{className:"bp3-dialog-footer-actions"},o.a.createElement(U.c,{onClick:()=>this.setState({showKeyDialog:!1}),text:"\u53d6\u6d88"}),o.a.createElement(U.c,{intent:"primary",onClick:()=>this.handleUpload(),text:"\u4e0a\u4f20"})))),o.a.createElement(U.i,{isOpen:this.state.url},o.a.createElement("div",{className:"overbox"},o.a.createElement("div",{className:"centerbox"},o.a.createElement(ae,{value:a}),o.a.createElement("div",null,o.a.createElement("div",{className:"explain"},"\u5fae\u4fe1\u626b\u7801\u5373\u53ef\u9605\u8bfb\uff0c\u53ef\u4fdd\u5b58\u56fe\u7247\u5206\u4eab\u5230\u670b\u53cb\u5708"),o.a.createElement("div",{className:"therow"},o.a.createElement(U.c,{text:"\u5173\u95ed",icon:"cross",onClick:()=>this.onClose(),large:!0}),o.a.createElement(U.b,{href:a,icon:"manual",text:"\u5f00\u59cb\u9605\u8bfb",large:!0,intent:"PRIMARY"})),o.a.createElement("div",{className:"std-hr"}),o.a.createElement(U.d,{fill:!0,vertical:!1},o.a.createElement(U.h,{value:a,readOnly:!0,large:!0}),o.a.createElement(re.CopyToClipboard,{text:a,onCopy:()=>alert("\u5df2\u590d\u5236\u5230\u526a\u8d34\u677f")},o.a.createElement(U.c,{text:"\u590d\u5236\u9605\u8bfb\u5730\u5740",large:!0}))))))))}})||le)||le)||le)||le);var ce,ie,me;let pe=(ce=Object(h.c)(),ie=Object(d.b)("store"),Object(p.f)(me=ce(me=ie(me=Object(d.c)(me=class extends r.Component{constructor(){super(...arguments),this.state={books:[],bookurl:""}}doJump(){this.props.history.push("/read/"+encodeURIComponent(encodeURIComponent(this.state.bookurl)))}componentDidMount(){!function(e,t){var a=new XMLHttpRequest;a.overrideMimeType("application/json"),a.open("GET",e,!0),a.onreadystatechange=function(){4===a.readyState&&"200"==a.status&&t(a.responseText)},a.send(null)}("books/index.json",e=>{e&&this.setState(Object(N.a)({},JSON.parse(e)))})}render(){const e=this.state.books;let t=1;const a=o.a.createElement("div",{className:"list-page"},o.a.createElement("div",{className:"jumpbox"},o.a.createElement("div",{className:"row"},o.a.createElement("div",{className:"left"},o.a.createElement(U.d,{fill:!0,vertical:!1},o.a.createElement(U.h,{placeholder:"\u8f93\u5165.h2book\u6587\u4ef6\u7684url...",value:this.state.bookurl,onChange:e=>{this.setState({bookurl:e.target.value})},large:!0}),o.a.createElement(U.c,{icon:"arrow-right",onClick:()=>{this.doJump()},large:!0}))),this.state.upload_url&&o.a.createElement("div",{className:"right"},o.a.createElement(oe,{upload_url:this.state.upload_url,site_url:this.state.site_url})))),o.a.createElement("div",{className:"logoline"},o.a.createElement("img",{src:"/image/h2.logo.png",alt:"logo"})),o.a.createElement("ul",{className:"booklist"},e.length>0&&e.map(e=>o.a.createElement(V,{key:t++,data:e}))));return o.a.createElement(v.a,{title:this.props.store.appname},a)}})||me)||me)||me)||me);class de extends r.Component{render(){return o.a.createElement(m.a,null,o.a.createElement(p.c,null,o.a.createElement(p.a,{path:"/read/:id",component:z}),o.a.createElement(p.a,{path:"/",component:pe})))}}var he=de;Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var ue,Ee,ge=a(136),be=a(137),ke=(a(373),a(3));var ve=new(ue=class{constructor(){Object(ge.a)(this,"appname",Ee,this)}},Ee=Object(be.a)(ue.prototype,"appname",[ke.l],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"\u65b9\u7cd6\u5c0f\u5267\u573a"}}),ue),fe=(a(374),a(82)),Oe=a(138),we=a(139),Ne=a.n(we);fe.a.use(Oe.a).use(Ne.a).use(h.b).init({fallbackLng:"zh-cn",ns:["translations"],defaultNS:"translations",debug:!1,saveMissing:!1,missingKeyHandler:function(e,t,a){var s=new URLSearchParams;s.append("lng",JSON.stringify(e)),s.append("ns",t),s.append("key",a);const{data:n}=Z.a.post("http://localhost:8088/misswords",s)},interpolation:{escapeValue:!1},react:{wait:!0}});var je=fe.a;i.a.render(o.a.createElement(d.a,{store:ve},o.a.createElement(h.a,{i18n:je},o.a.createElement(he,null))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(e=>{e.unregister()})}},[[196,1,2]]]);
//# sourceMappingURL=main.e9e1b494.chunk.js.map