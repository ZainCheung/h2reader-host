{"version":3,"sources":["component/LangLink.js","screen/Login.js","component/AvatarSquare.js","component/TalkItem.js","component/TalkList.js","screen/Reader.js","component/BookItem.js","component/QRImage.js","component/UploadButton.js","screen/List.js","App.js","serviceWorker.js","store/AppState.js","i18n.js","index.js"],"names":["LangLink","_dec","translate","_dec2","inject","withRouter","_class","observer","Component","setLang","lang","this","props","i18n","changeLanguage","render","React","createElement","className","onClick","t","main","DocumentTitle","title","store","appname","AvatarSquare","url","data","base64","class_name","e","src","alt","name","LinkRenderer","href","target","children","ImageZoomed","ImageZoom","image","TalkItem","talk","role","roles","filter","item","id","role_id","role_class","role_ismain","type","data-id","ReactMarkdown","source","text","renderers","link","TalkList","constructor","super","showToId","to_index","alltalks","forEach","index","console","log","setState","slice","setTimeout","toBottom","showOne","state","talks","length","talks1","thetalk","shift","show_talks1","show_talks","push","end_ref","current","scrollIntoView","message","nextBook","confirmHandler","cancelHandler","createRef","componentDidMount","loadData","componentDidUpdate","prevProps","current_talk_id","showAlert","arguments","undefined","isAlertOpen","alertData","goBack","currentId","location","pathname","split","pop","decodeURIComponent","replace","fetch","then","response","json","books","currentIndex","findIndex","book","bookurl","concat","window","catch","error","Alert","isOpen","confirmButtonText","cancelButtonText","intent","Intent","PRIMARY","icon","onConfirm","onCancel","canEscapeKeyCancel","canOutsideClickCancel","Fragment","map","key","Link","to","Icon","iconSize","meta","author","detail","ref","style","end","Reader","bookid","bookpath","param","match","params","isNaN","parseInt","file","callback","rawFile","XMLHttpRequest","overrideMimeType","open","onreadystatechange","readyState","status","responseText","send","readTextFile","jsondata","JSON","parse","sortedTalks","sort","a","b","chapter_id","order","_objectSpread","alert","history","BookItem","encodeURIComponent","Button","minimal","QRImage","value","ck","setInterval","check","canvas","document","getElementById","toDataURL","clearInterval","img_url","QRCode","size","includeMargin","UploadButton","drop_ref","showKeyDialog","uploadKey","selectedFile","acceptedFiles","formData","FormData","append","uploadUrl","upload_url","startsWith","protocol","host","axios","post","headers","code","onClose","confirm","baseUrl","origin","siteUrl","site_url","read_url","Dropzone","accept","maxSize","multiple","onDrop","onDropped","_ref","getRootProps","getInputProps","large","Dialog","FormGroup","label","InputGroup","onChange","placeholder","handleUpload","Overlay","AnchorButton","ControlGroup","fill","vertical","readOnly","CopyToClipboard","onCopy","List","doJump","count","evt","App","Router","Switch","Route","path","component","Boolean","hostname","_initializerDefineProperty","_descriptor","_applyDecoratedDescriptor","prototype","observable","configurable","enumerable","writable","initializer","use","Backend","LanguageDetector","reactI18nextModule","init","fallbackLng","ns","defaultNS","debug","saveMissing","missingKeyHandler","lng","URLSearchParams","stringify","dev_api","interpolation","escapeValue","react","wait","ReactDOM","Provider","AppState","I18nextProvider","navigator","serviceWorker","ready","registration","unregister"],"mappings":"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","file":"static/js/main.e9e1b494.chunk.js","sourcesContent":["import React, { Component } from 'react';\nimport { observer , inject } from 'mobx-react';\nimport { withRouter } from 'react-router-dom';\nimport { translate } from 'react-i18next';\n\n@withRouter\n@translate()\n@inject(\"store\")\n@observer\nexport default class LangLink extends Component\n{\n    setLang( lang )\n    {\n        this.props.i18n.changeLanguage( lang );\n    }\n    render()\n    {\n        return <div>\n            <span className=\"pointer\" onClick={()=>this.setLang('zh-cn')}>中文</span> · <span className=\"pointer\" onClick={()=>this.setLang('en')}>English</span>\n        </div>;\n    }\n}","import React, { Component } from 'react';\nimport { observer , inject } from 'mobx-react';\nimport { withRouter,Link } from 'react-router-dom';\nimport { translate } from 'react-i18next';\nimport LangLink from '../component/LangLink'; \nimport DocumentTitle from 'react-document-title';\n\n@withRouter\n@translate()\n@inject(\"store\")\n@observer\nexport default class Login extends Component\n{\n    render()\n    {\n        const { t } = this.props;\n        const main = <div className=\"box\">\n            <div className=\"title\">{t(\"Welcome\")}</div>\n            <div className=\"lang\"> <LangLink /></div>\n        </div>;\n        return <DocumentTitle title={this.props.store.appname}>{main}</DocumentTitle>;\n    }\n}","import React, { Component } from 'react';\nimport { observer , inject } from 'mobx-react';\nimport { withRouter } from 'react-router-dom';\nimport { translate } from 'react-i18next';\n\n@withRouter\n@translate()\n@inject(\"store\")\n@observer\nexport default class AvatarSquare extends Component\n{\n    // constructor(props) \n    // {\n    //     super(props);\n    // }\n    \n    // componentDidMount()\n    // {\n    //    // \n    // }\n\n    render()\n    {\n        // const store = this.props.store;\n        const props = this.props;\n\n        const url = props.data.base64 || \"/image/h2.any.png\"; \n        const class_name = props.className ? \"avatar-square \" + props.className :  \"avatar-square \";\n        \n        return <div className={class_name} onClick={(e)=>{if(props.onClick)props.onClick(e);}}><img src={url} alt={props.data.name} /></div>;\n    }\n}","import React, { Component } from 'react';\nimport { observer , inject } from 'mobx-react';\nimport { withRouter } from 'react-router-dom';\nimport { translate } from 'react-i18next';\nimport AvatarSquare from '../component/AvatarSquare';\nimport ImageZoom from 'react-medium-image-zoom';\nimport ReactMarkdown from 'react-markdown';\n\nfunction LinkRenderer(props) \n{\n    return <a href={props.href} target=\"_blank\">{props.children}</a>\n}\n\nfunction ImageZoomed( props )\n{\n    return <ImageZoom  \n    image={{ src: props.src , className:\"imginbox\" }} \n    />\n}\n\n@withRouter\n@translate()\n@inject(\"store\")\n@observer\nexport default class TalkItem extends Component\n{\n    // constructor(props) \n    // {\n    //     super(props);\n    // }\n    \n    // componentDidMount()\n    // {\n    //    // \n    // }\n\n    render()\n    {\n        const store = this.props.store;\n        const props = this.props;\n\n        if( !props.data ) return null;\n\n        const talk = props.data;\n        const role = props.roles.filter( item => item.id == talk.role_id )[0];\n        const role_class = talk.role_ismain ? \" role main \" : \" role notmain\";\n\n        // console.log( \"role\" , props.roles );\n        \n        return talk.type == 'role' \n            ?\n                \n                <div className={\"talk-list-item-ro\"+role_class} data-id={talk.id}>\n                <div className=\"avatarside\">\n                    <AvatarSquare data={role} className=\"s48\"/>\n                </div>\n                <div className=\"contentside\">\n                    <div className=\"name\">{role.name}</div>\n                    <div className=\"text\"><ReactMarkdown source={talk.text} renderers={{link: LinkRenderer,image:ImageZoomed}}/></div>\n                </div>\n                \n                </div>\n            :\n            <div className=\"talk-list-item-ro aside\" ><div className=\"aside-text\"><ReactMarkdown source={talk.text} renderers={{link: LinkRenderer,image:ImageZoomed}}/></div></div>;\n    }\n}","import React, { Component } from 'react';\nimport { observer , inject } from 'mobx-react';\nimport { withRouter, Link } from 'react-router-dom';\nimport { translate } from 'react-i18next';\nimport TalkItem from '../component/TalkItem'; \nimport { Icon, AnchorButton, Alert, Intent } from \"@blueprintjs/core\";\n\n@withRouter\n@translate()\n@inject(\"store\")\n@observer\nexport default class TalkList extends Component\n{\n    constructor(props) \n    {\n        super(props);\n        this.state = {\n            \"talks\":[],\n            \"show_talks\":[],\n            \"end\":false,\n            \"isAlertOpen\": false,\n            \"alertData\": {\n                message: \"\",\n                nextBook: null,\n                confirmHandler: null,\n                cancelHandler: null\n            }\n        };\n        this.end_ref = React.createRef();\n    }\n\n    componentDidMount()\n    {\n       this.loadData();\n    }\n\n    loadData()\n    {\n        this.alltalks = this.props.talks;\n        this.setState( { \"talks\": this.props.talks , \"end\" : this.props.talks.length < 1 } );\n    }\n\n    componentDidUpdate(prevProps)\n    {\n        if (this.props.current_talk_id !== prevProps.current_talk_id) \n        {\n            this.loadData();\n            this.showToId( this.props.current_talk_id );\n            this.toBottom();\n            // console.log( \"now id\" , this.props.current_talk_id );\n        }\n    }\n\n    showToId = ( id ) =>\n    {\n        let to_index = -1;\n        this.alltalks.forEach( ( item , index ) => \n        {\n            if( item.id == id ) to_index = index;\n            // else console.log( \"item.id != id\", item.id , id );\n\n        } );\n\n        console.log( \"to_index\",to_index );\n        if( to_index >= 0 )\n        {\n            this.setState({\n                \"show_talks\":this.alltalks.slice(0,to_index+1),\n                \"talks\":this.alltalks.slice(to_index+1)\n            })\n\n            setTimeout(() => {\n                this.toBottom();\n            }, 100);\n        }\n    }\n\n\n\n    showOne = ()=>\n    {\n        const state = this.state;\n        if( state.talks.length < 1 )\n        {\n            this.setState( { \"end\": true} );\n            return false;\n        } \n\n        let talks1 = state.talks;\n        let thetalk = talks1.shift();\n        let show_talks1 = state.show_talks;\n        show_talks1.push(thetalk);\n\n        this.setState( { \"talks\":talks1 , \"show_talks\":show_talks1 } );\n\n        setTimeout(() => {\n            this.toBottom();\n        }, 100);\n        \n\n        return thetalk;\n \n    }\n\n    toBottom = () =>\n    {\n        if( this.end_ref && this.end_ref.current )\n            this.end_ref.current.scrollIntoView( true );\n    }\n\n    showAlert(message, nextBook = null, confirmHandler, cancelHandler) {\n        this.setState({\n            isAlertOpen: true,\n            alertData: {\n                message,\n                nextBook,\n                confirmHandler,\n                cancelHandler\n            }\n        });\n    }\n\n    goBack()\n    {\n        // 从当前 URL 获取当前章节 ID\n        const currentPath = this.props.location.pathname;\n        let currentId = currentPath.split('/').pop();\n        // 进行 URL 解码\n        currentId = decodeURIComponent(currentId);\n        // 移除 .h2book 后缀\n        currentId = currentId.replace(/\\.h2book$/, '');\n        \n        // 读取 books/index.json\n        fetch('/books/index.json')\n            .then(response => response.json())\n            .then(data => {\n                const books = data.books;\n                const currentIndex = books.findIndex(book => book.bookurl === currentId);\n                \n                // 检查是否有下一章\n                if (currentIndex > -1 && currentIndex < books.length - 1) {\n                    const nextBook = books[currentIndex + 1];\n                    this.showAlert(\n                        `是否继续阅读下一章《${nextBook.name}》？`,\n                        nextBook,\n                        () => {\n                            this.setState({ isAlertOpen: false });\n                            // this.props.history.push(`/read/${nextBook.bookurl}`);\n                            window.location.href = `/read/${nextBook.bookurl}`;\n                        },\n                        () => {\n                            this.setState({ isAlertOpen: false });\n                            window.location.href = \"/\";\n                        }\n                    );\n                } else {\n                     window.location.href = \"/\";\n                }\n            })\n            .catch(error => {\n                console.error('Error:', error);\n                // 如果出错，使用原来的逻辑\n                this.showAlert(\n                    \"当前章节已经完成，是否返回首页？\",\n                    null,\n                    () => {\n                        this.setState({ isAlertOpen: false });\n                        window.location.href = \"/\";\n                    },\n                    () => {\n                        this.setState({ isAlertOpen: false });\n                    }\n                );\n            });\n    }\n\n    \n\n    render()\n    {\n        const state = this.state;\n        const props = this.props;\n        \n        \n        return  state.talks  ?\n        <div className=\"talklist-ro\" >\n            <Alert\n                isOpen={state.isAlertOpen}\n                confirmButtonText={state.alertData.nextBook ? \"继续阅读\" : \"返回首页\"}\n                cancelButtonText=\"取消\"\n                intent={Intent.PRIMARY}\n                icon=\"help\"\n                onConfirm={state.alertData.confirmHandler}\n                onCancel={state.alertData.cancelHandler}\n                canEscapeKeyCancel={true}\n                canOutsideClickCancel={true}\n            >\n                {state.alertData.message}\n            </Alert>\n            <div className=\"thelist\">\n            { state.show_talks.length > 0 \n            ? \n            <>\n            {state.show_talks.map( item => <TalkItem roles={props.roles} key={item.id} data={item} /> ) }\n            </>\n            : \n            \n            <div className=\"guide\">\n                <div className=\"logo\"> <img src=\"/image/h2.logo.png\" /> </div>\n                <div className=\"back\">\n                    <Link to=\"/\"><Icon iconSize={40} icon=\"circle-arrow-left\" /></Link>\n                </div>\n                { this.props.meta && <><div className=\"name\">{this.props.meta.name}</div>\n                <div className=\"author\"><Icon icon=\"user\" /> {this.props.meta.author}</div>\n                <div className=\"link\"><Icon icon=\"link\" /> {this.props.meta.link}</div>\n                <div className=\"detail\">{this.props.meta.detail}</div></>  }\n                <div className=\"continue\">点击下方的 ✦ 开始</div>\n                \n\n            </div> \n            }\n\n            <div ref={this.end_ref} style={{\"marginTop\":\"100px\"}}></div>\n            \n\n            </div>\n            <div className=\"touchpad\" onClick={()=>this.showOne()}>\n                {state.end ? <span className=\"blink noselect\" onClick={()=>this.goBack()}> done </span> : <span className=\"blink noselect\" > ✦ </span>}\n            </div>\n            \n        </div> : null ;\n    }\n}","import React, { Component } from 'react';\nimport { observer , inject } from 'mobx-react';\nimport { Link } from \"react-router-dom\";\nimport { withRouter } from 'react-router-dom';\nimport { translate } from 'react-i18next';\nimport JSZipUtils from 'jszip-utils';\nimport JSZip from 'jszip';\nimport DocumentTitle from 'react-document-title';\nimport TalkList from '../component/TalkList';\n\nfunction readTextFile(file, callback) \n{\n    var rawFile = new XMLHttpRequest();\n    rawFile.overrideMimeType(\"application/json\");\n    rawFile.open(\"GET\", file, true);\n    rawFile.onreadystatechange = function() {\n        if (rawFile.readyState === 4 && rawFile.status == \"200\") {\n            callback(rawFile.responseText);\n        }\n    }\n    rawFile.send(null);\n}\n\nconst sortTalks = (talks) => {\n  return [...talks].sort((a, b) => {\n    // 首先按 chapter_id 排序\n    if (a.chapter_id !== b.chapter_id) {\n      return a.chapter_id - b.chapter_id;\n    }\n    // chapter_id 相同时，按 order 排序\n    return a.order - b.order;\n  });\n};\n\n@withRouter\n@translate()\n@inject(\"store\")\n@observer\nexport default class Reader extends Component\n{\n    // constructor(props) \n    // {\n    //     super(props);\n    // }\n    state = { \"meta\":{} , \"talks\":[] , \"roles\":[] , \"show_talks\":[] }\n    \n    componentDidMount()\n    {\n        let bookid = 1;\n        let bookpath = `/books/${bookid}.h2book`;\n\n        const param = this.props.match.params.id;\n        if( isNaN( param ) )\n        {\n            // 字符串\n            bookpath = decodeURIComponent( param );\n        }\n        else\n        {\n           // 数字\n           if( parseInt(param) > 0 ) bookid = parseInt(param);\n           else bookid = 1;\n\n           bookpath = `/books/${bookid}.h2book`;\n        }\n        \n        \n        \n        \n\n        try\n        {\n            // JSZipUtils.getBinaryContent( bookpath , async ( err, data ) => \n            // {\n            //     if(err) \n            //     {\n            //         window.alert(\"文件载入失败，请返回确认地址是否正确。\");\n            //         console.log( err );\n            //         this.props.history.replace(\"/\");\n            //         // throw err; // or handle err\n            //     }\n            //     else\n            //     {\n            //         //console.log(\"FILE OK\");\n\n            //         const zip = await JSZip.loadAsync( data );\n            //         const data2 = await zip.file(\"h2content.json\").async(\"string\");\n            //         const jsondata = JSON.parse( data2 );\n\n            //         if( jsondata )\n            //         {\n            //             this.setState( {...jsondata} );\n            //         }                \n            //     }\n            // });\n            readTextFile( bookpath , ( data ) =>\n            {\n                const jsondata = JSON.parse( data );\n\n                if( jsondata )\n                {\n                    const sortedTalks = sortTalks(jsondata.talks);\n                    jsondata.talks = sortedTalks;\n                    this.setState( {...jsondata} );\n                }   \n            });\n\n        }catch( e )\n        {\n            alert(\"文件载入失败，请返回确认地址是否正确。\");\n            console.log( e );\n            this.props.history.replace(\"/\");\n        }\n        \n\n        \n        \n        \n \n    }\n\n    render()\n    {\n        const state = this.state;\n\n        const main = <div className=\"read-page\">{state.talks && state.talks.length > 0 && <TalkList talks={state.talks} roles={state.roles} meta={state.meta}  />}\n        </div>;\n\n        const title = state.meta.name ? state.meta.name + '@' + this.props.store.appname : this.props.store.appname;\n\n        return <DocumentTitle title={title}>{main}</DocumentTitle>;\n    }\n}","import React, { Component } from 'react';\nimport { observer , inject } from 'mobx-react';\nimport { withRouter, Link } from 'react-router-dom';\nimport { translate } from 'react-i18next';\nimport { Button  } from \"@blueprintjs/core\";\n\n@withRouter\n@translate()\n@inject(\"store\")\n@observer\nexport default class BookItem extends Component\n{\n    // constructor(props) \n    // {\n    //     super(props);\n    // }\n    \n    // componentDidMount()\n    // {\n    //    // \n    // }\n\n    // componentDidUpdate(prevProps)\n    // {\n    //     if (this.props.data !== prevProps.data) \n    //     {\n           \n    //     }\n    // }\n    \n    render()\n    {\n        const item = this.props.data;\n        if( !item ) return null;\n\n        return <li onClick={()=>this.props.history.push('/read/'+encodeURIComponent(item.bookurl) )}>\n            <span>{item.name}</span>\n            <Button icon=\"chevron-right\" minimal={true} />\n        </li>;\n    }\n}","import React, { Component } from 'react';\nimport { observer , inject } from 'mobx-react';\nimport { withRouter } from 'react-router-dom';\nimport QRCode from 'qrcode.react';\n\n@withRouter\n@inject(\"store\")\n@observer\nexport default class QRImage extends Component\n{\n    state = {\"value\":this.props.value,\"img_url\":\"\"};\n    \n    componentDidMount()\n    {\n        this.ck=setInterval( ()=>this.check() , 1000 );\n    }\n\n    check()\n    {\n        const canvas = document.getElementById('theqr__inbox');\n        if( canvas )\n        {\n            this.setState({\"img_url\":canvas.toDataURL(\"image/png\")});\n            clearInterval( this.ck );\n        }\n    }\n    \n    \n    render()\n    {\n        // <QRCode value={this.state.qr_code}  /> \n        return <div className={this.props.className}>\n            { this.state.img_url.length > 0 ? <img src={this.state.img_url} /> : <QRCode size={300} value={this.state.value} id=\"theqr__inbox\" includeMargin={true}  /> }\n        </div>\n         ;\n    }\n}","import React, { Component } from 'react';\nimport { observer , inject } from 'mobx-react';\nimport { withRouter } from 'react-router-dom';\nimport { translate } from 'react-i18next';\n\nimport { Button, Overlay, ControlGroup, InputGroup, AnchorButton, Dialog, FormGroup  } from \"@blueprintjs/core\";\nimport Dropzone from 'react-dropzone';\nimport axios from 'axios';\nimport QRImage from '../component/QRImage';\nimport {CopyToClipboard} from 'react-copy-to-clipboard';\n\n@withRouter\n@translate()\n@inject(\"store\")\n@observer\nexport default class UploadButton extends Component\n{\n    constructor(props) \n    {\n        super(props);\n        this.drop_ref = React.createRef();\n        this.state = { \n            url: false,\n            showKeyDialog: false,\n            uploadKey: '',\n            selectedFile: null\n        };\n    }\n    \n    // componentDidMount()\n    // {\n    //    // \n    // }\n    async onDropped( acceptedFiles )\n    {\n        this.setState({\n            selectedFile: acceptedFiles[0],\n            showKeyDialog: true\n        });\n    }\n\n    async handleUpload() {\n        try {\n            const formData = new FormData();\n            formData.append(\"book\", this.state.selectedFile);\n            formData.append(\"upload_key\", this.state.uploadKey);\n\n            let uploadUrl = this.props.upload_url;\n            \n            if(uploadUrl.startsWith('/')) {\n                const protocol = window.location.protocol;\n                const host = window.location.host;\n                uploadUrl = `${protocol}//${host}${uploadUrl}`;\n            }\n\n            const response = await axios.post(uploadUrl, formData, {\n                headers: {\n                    'Content-Type': 'multipart/form-data'\n                }\n            });\n\n            if(response.data.code === 0) {\n                this.setState({\n                    url: response.data.data.url,\n                    showKeyDialog: false,\n                    uploadKey: '',\n                    selectedFile: null\n                });\n            } else {\n                alert('上传失败: ' + response.data.message);\n            }\n        } catch (error) {\n            console.error('Upload error:', error);\n            if (error.response && error.response.data && error.response.data.message) {\n                alert('上传失败: ' + error.response.data.message);\n            } else {\n                alert('上传失败,请检查服务器连接');\n            }\n        }\n    }\n\n    onClose()\n    {\n        if( !window.confirm(\"关闭后将无法找到这个地址，请确定保存后再关闭。是否继续？\") ) return false;\n\n        this.setState({url:false});\n    }\n\n    \n\n    render()\n    {\n        // 获取当前站点URL作为基础URL\n        const baseUrl = window.location.origin;\n        \n        // 如果 site_url 为空,就使用当前站点URL\n        const siteUrl = this.props.site_url || baseUrl;\n        \n        // 构建完整的阅读URL\n        const read_url = this.state.url ? `${siteUrl}/read/${encodeURIComponent(this.state.url)}` : '';\n\n        return <><Dropzone \n        accept=\".h2book\"  \n        maxSize={1024*1024*10}\n        multiple={false} \n        ref={this.drop_ref} \n        onDrop={acceptedFiles => this.onDropped(acceptedFiles)}>\n        {({getRootProps, getInputProps}) => (\n          <div {...getRootProps()}>\n              {/*  */}\n              <input {...getInputProps()} />\n              <Button icon=\"upload\" large={true} />\n          </div>\n          \n\n        )}\n            </Dropzone>\n\n            <Dialog\n                isOpen={this.state.showKeyDialog}\n                onClose={() => this.setState({ showKeyDialog: false })}\n                title=\"请输入上传密钥\"\n            >\n                <div className=\"bp3-dialog-body\">\n                    <FormGroup label=\"上传密钥\">\n                        <InputGroup\n                            value={this.state.uploadKey}\n                            onChange={(e) => this.setState({ uploadKey: e.target.value })}\n                            placeholder=\"请输入上传密钥\"\n                        />\n                    </FormGroup>\n                </div>\n                <div className=\"bp3-dialog-footer\">\n                    <div className=\"bp3-dialog-footer-actions\">\n                        <Button onClick={() => this.setState({ showKeyDialog: false })} text=\"取消\" />\n                        <Button intent=\"primary\" onClick={() => this.handleUpload()} text=\"上传\" />\n                    </div>\n                </div>\n            </Dialog>\n\n            <Overlay isOpen={this.state.url } >\n            <div className=\"overbox\">\n                <div className=\"centerbox\">\n                    <QRImage value={read_url} />\n                    <div>\n\n                    <div className=\"explain\">微信扫码即可阅读，可保存图片分享到朋友圈</div>\n\n                    <div className=\"therow\">\n                    <Button text=\"关闭\" icon=\"cross\" onClick={()=>this. onClose()} large={true} />\n\n                    <AnchorButton href={read_url} icon=\"manual\"  text=\"开始阅读\" large={true} intent=\"PRIMARY\" />\n                   \n                    </div>\n\n                    <div className=\"std-hr\"></div>\n\n                    <ControlGroup fill={true} vertical={false}>\n                    <InputGroup value={read_url} readOnly={true} large={true} />\n\n                    \n                    \n                    <CopyToClipboard text={read_url} onCopy={()=>alert(\"已复制到剪贴板\")}>\n                        <Button text=\"复制阅读地址\" large={true} />\n                    </CopyToClipboard>\n\n                    </ControlGroup>\n\n                    \n\n                    \n                    \n                    </div>\n                    \n                </div>\n            </div>\n            \n            </Overlay>\n        </>\n    }\n}","import React, { Component } from 'react';\nimport { observer , inject } from 'mobx-react';\nimport { Link } from \"react-router-dom\";\nimport { withRouter } from 'react-router-dom';\nimport { translate } from 'react-i18next';\nimport { ControlGroup, InputGroup, Button, FileInput  } from \"@blueprintjs/core\";\nimport BookItem from '../component/BookItem'; \nimport UploadButton from '../component/UploadButton'; \n\n\n\nimport DocumentTitle from 'react-document-title';\n\nfunction readTextFile(file, callback) \n{\n    var rawFile = new XMLHttpRequest();\n    rawFile.overrideMimeType(\"application/json\");\n    rawFile.open(\"GET\", file, true);\n    rawFile.onreadystatechange = function() {\n        if (rawFile.readyState === 4 && rawFile.status == \"200\") {\n            callback(rawFile.responseText);\n        }\n    }\n    rawFile.send(null);\n}\n\n@withRouter\n@translate()\n@inject(\"store\")\n@observer\nexport default class List extends Component\n{\n    state = { \n        \"books\":[],\n        \"bookurl\":\"\"\n    }\n\n    doJump()\n    {\n        this.props.history.push('/read/'+encodeURIComponent(encodeURIComponent( this.state.bookurl )));\n        //console.log( this.props );\n    }\n    \n    componentDidMount()\n    {\n        readTextFile( 'books/index.json' , ( data )=>\n        {\n            if( data )\n                this.setState( { ...JSON.parse( data ) } )\n        } );\n        \n    }\n\n    render()\n    {\n        const books = this.state.books;\n        let count = 1;\n        \n        const main = <div className=\"list-page\">\n        <div className=\"jumpbox\">\n            <div className=\"row\">\n                <div className=\"left\">\n                    <ControlGroup fill={true} vertical={false}>\n\n                    <InputGroup placeholder=\"输入.h2book文件的url...\" value={this.state.bookurl} onChange={ ( evt )=>{ this.setState( { \"bookurl\" : evt.target.value } ) }} large={true} />\n\n                    <Button icon=\"arrow-right\" onClick={()=>{this.doJump()}} large={true} />\n\n                    </ControlGroup>\n                </div>\n                { this.state.upload_url &&  <div className=\"right\">\n                    <UploadButton upload_url={this.state.upload_url} site_url={this.state.site_url} />\n                    \n                </div> }\n            </div>\n        \n\n        \n        </div>\n\n        <div className=\"logoline\">\n            <img src=\"/image/h2.logo.png\" alt=\"logo\"/>\n            {/* <div className=\"subtitle\">列表</div> */}\n        </div>\n        <ul className=\"booklist\">\n        { books.length > 0 && books.map((item)=>{\n            // console.log( item );\n            return <BookItem key={count++} data={item} /> \n        }) }\n        </ul>\n        \n    </div>;\n        return <DocumentTitle title={this.props.store.appname}>{main}</DocumentTitle>;\n    }\n}","import React, { Component } from 'react';\nimport { BrowserRouter as Router, Route, Switch } from 'react-router-dom';\n\nimport Login from './screen/Login';\nimport Reader from './screen/Reader'; \nimport List from './screen/List'; \n\n\n\nclass App extends Component {\n  render() {\n    return (\n      <Router>\n        <Switch>\n          <Route path=\"/read/:id\" component={Reader} />\n          <Route path=\"/\" component={List} />\n          \n        </Switch>\n      </Router>  \n    );\n  }\n}\n\nexport default App;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read http://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit http://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See http://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import { observable, action } from \"mobx\";\nimport axios from 'axios';\n\nclass AppState\n{\n    @observable appname = \"方糖小剧场\";    \n}\n\nexport default new AppState();","import i18n from 'i18next';\nimport Backend from 'i18next-xhr-backend';\nimport LanguageDetector from 'i18next-browser-languagedetector';\nimport { reactI18nextModule } from 'react-i18next';\nimport axios from 'axios';\n\n\nconst dev_api = 'http://localhost:8088/';\n\ni18n\n  .use(Backend)\n  .use(LanguageDetector)\n  .use(reactI18nextModule)\n  .init({\n    fallbackLng: 'zh-cn',\n\n    // have a common namespace used around the full app\n    ns: ['translations'],\n    defaultNS: 'translations',\n\n    debug: false,\n    saveMissing:false,\n    missingKeyHandler: function(lng, ns, key) {\n        var params = new URLSearchParams();\n        params.append(\"lng\" , JSON.stringify( lng ));\n        params.append(\"ns\" ,  ns );\n        params.append(\"key\" , key );\n        const { data } = axios.post( dev_api + 'misswords' , params );\n    },\n    interpolation: {\n      escapeValue: false, // not needed for react!!\n    },\n\n    react: {\n      wait: true\n    }\n  });\n\n\nexport default i18n;","import React from 'react';\nimport ReactDOM from 'react-dom';\n\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\n\nimport { Provider } from \"mobx-react\";\nimport AppState from './store/AppState';\n\nimport './index.scss';\n\nimport { I18nextProvider } from 'react-i18next';\nimport i18n from './i18n'; \n\nReactDOM.render(<Provider store={AppState}>\n                    <I18nextProvider i18n={ i18n }>\n                        <App />\n                    </I18nextProvider>    \n                </Provider>, document.getElementById('root'));\nserviceWorker.unregister();\n\n"],"sourceRoot":""}